<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>賓果抽號機</title>
  <style>
    :root {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: #0f172a;
      background: #f8fafc;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .card {
      width: min(100%, 420px);
      background: #ffffff;
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.1);
    }

    h1,
    h2 {
      margin-top: 0;
      text-align: center;
    }

    p {
      margin: 0.4rem 0 1rem;
      text-align: center;
      color: #475569;
    }

    .number-display {
      font-size: clamp(3rem, 20vw, 5rem);
      font-weight: 700;
      text-align: center;
      margin: 1rem 0;
      color: #1d4ed8;
      min-height: 1.2em;
    }

    .label {
      font-size: 1rem;
      text-align: center;
      color: #334155;
    }

    .controls {
      display: grid;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .speed-control {
      margin-top: 1rem;
      padding: 0.8rem;
      border-radius: 10px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
    }

    .speed-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.95rem;
      color: #334155;
      margin-bottom: 0.4rem;
    }

    input[type='range'] {
      width: 100%;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 0.9rem 1rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
    }

    .primary {
      background: #2563eb;
      color: #fff;
    }

    .secondary {
      background: #e2e8f0;
      color: #0f172a;
    }

    .ghost {
      background: #f1f5f9;
      color: #1e293b;
    }

    button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
    }

    .hidden {
      display: none;
    }

    .seen-container {
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid #e2e8f0;
    }

    .seen-list {
      display: grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 0.35rem;
      margin-top: 0.5rem;
      font-size: 0.95rem;
      color: #334155;
    }

    .seen-list span {
      background: #f8fafc;
      border-radius: 6px;
      text-align: center;
      padding: 0.2rem;
      border: 1px solid #e2e8f0;
    }

    .voice-hint {
      margin-top: 0.8rem;
      font-size: 0.85rem;
      color: #64748b;
      text-align: center;
    }
  </style>
</head>
<body>
  <main class="card">
    <section id="welcome-screen">
      <h1>賓果抽號機</h1>
      <p>每回合從 1 到 75 隨機抽號且不重複。</p>
      <div class="controls">
        <button id="start-button" class="primary">開始遊戲</button>
      </div>
    </section>

    <section id="game-screen" class="hidden">
      <h2>賓果回合</h2>
      <div class="label">目前號碼</div>
      <div id="current-number" class="number-display">--</div>

      <div class="speed-control">
        <div class="speed-row">
          <span>語音速度</span>
          <strong id="speed-value">1.0x</strong>
        </div>
        <input id="speed-slider" type="range" min="0.6" max="1.5" step="0.1" value="1.0" />
      </div>

      <div class="controls">
        <button id="next-button" class="primary">下一個號碼</button>
        <button id="toggle-seen-button" class="secondary">顯示已開號碼</button>
        <button id="restart-button" class="ghost">新回合</button>
      </div>

      <div id="seen-container" class="seen-container hidden">
        <div class="label">目前已開號碼</div>
        <div id="seen-list" class="seen-list"></div>
      </div>

      <div class="voice-hint">提示：請開啟裝置音量，語音會以繁體中文播報。</div>
    </section>
  </main>

  <script>
    const welcomeScreen = document.getElementById('welcome-screen');
    const gameScreen = document.getElementById('game-screen');
    const startButton = document.getElementById('start-button');
    const nextButton = document.getElementById('next-button');
    const restartButton = document.getElementById('restart-button');
    const toggleSeenButton = document.getElementById('toggle-seen-button');
    const currentNumber = document.getElementById('current-number');
    const seenContainer = document.getElementById('seen-container');
    const seenList = document.getElementById('seen-list');
    const speedSlider = document.getElementById('speed-slider');
    const speedValue = document.getElementById('speed-value');

    let remainingNumbers = [];
    let calledNumbers = [];
    let selectedVoice = null;
    let audioContext = null;

    function updateSpeedLabel() {
      speedValue.textContent = `${Number(speedSlider.value).toFixed(1)}x`;
    }

    function getSpeechRate() {
      return Number(speedSlider.value);
    }

    function initVoiceList() {
      if (!('speechSynthesis' in window)) return;
      const voices = speechSynthesis.getVoices();
      selectedVoice = voices.find((voice) => voice.lang === 'zh-TW')
        || voices.find((voice) => voice.lang.startsWith('zh-'))
        || null;
    }

    function ensureAudioContext() {
      if (!audioContext) {
        const Context = window.AudioContext || window.webkitAudioContext;
        if (!Context) return;
        audioContext = new Context();
      }
      if (audioContext.state === 'suspended') {
        audioContext.resume();
      }
    }

    function playFallbackTone() {
      if (!audioContext) return;
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.type = 'sine';
      oscillator.frequency.value = 880;
      gainNode.gain.value = 0.04;

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.start();
      oscillator.stop(audioContext.currentTime + 0.15);
    }

    function resetRound() {
      remainingNumbers = Array.from({ length: 75 }, (_, index) => index + 1);
      calledNumbers = [];
      currentNumber.textContent = '--';
      seenList.innerHTML = '';
      seenContainer.classList.add('hidden');
      toggleSeenButton.textContent = '顯示已開號碼';
      nextButton.disabled = false;
    }

    function speakNumber(number) {
      ensureAudioContext();
      playFallbackTone();

      if (!('speechSynthesis' in window)) return;

      const utterance = new SpeechSynthesisUtterance(`第 ${number} 號`);
      utterance.lang = 'zh-TW';
      utterance.rate = getSpeechRate();

      if (selectedVoice) {
        utterance.voice = selectedVoice;
      }

      speechSynthesis.cancel();
      speechSynthesis.speak(utterance);
    }

    function renderSeenNumbers() {
      seenList.innerHTML = '';

      calledNumbers
        .slice()
        .sort((a, b) => a - b)
        .forEach((number) => {
          const chip = document.createElement('span');
          chip.textContent = number;
          seenList.appendChild(chip);
        });
    }

    function drawNextNumber() {
      if (!remainingNumbers.length) {
        currentNumber.textContent = '完成';
        nextButton.disabled = true;
        return;
      }

      const randomIndex = Math.floor(Math.random() * remainingNumbers.length);
      const [next] = remainingNumbers.splice(randomIndex, 1);

      calledNumbers.push(next);
      currentNumber.textContent = next;
      renderSeenNumbers();
      speakNumber(next);

      if (!remainingNumbers.length) {
        nextButton.disabled = true;
      }
    }

    startButton.addEventListener('click', () => {
      initVoiceList();
      ensureAudioContext();
      resetRound();
      welcomeScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');
      drawNextNumber();
    });

    nextButton.addEventListener('click', drawNextNumber);

    toggleSeenButton.addEventListener('click', () => {
      const isHiddenAfterToggle = seenContainer.classList.toggle('hidden');
      toggleSeenButton.textContent = isHiddenAfterToggle ? '顯示已開號碼' : '隱藏已開號碼';
    });

    restartButton.addEventListener('click', () => {
      resetRound();
      drawNextNumber();
    });

    speedSlider.addEventListener('input', updateSpeedLabel);

    if ('speechSynthesis' in window) {
      speechSynthesis.onvoiceschanged = initVoiceList;
      initVoiceList();
    }

    updateSpeedLabel();
  </script>
</body>
</html>
